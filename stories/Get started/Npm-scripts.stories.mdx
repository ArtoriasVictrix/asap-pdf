import { Meta } from '@storybook/addon-docs';

<Meta title='Get started/Npm scripts' />


# üìÑ npm scripts description

### Build and run modes

ASAP PDF has many commands for running and building a project in different modes. These are the two main modes.

#### Production

Building/running a project in **production** mode includes:
- Compression (optimization) of resources before encoding in Base64;
- Removal of all unused classes from CSS before inserting CSS into HTML;
- Encoding of all resources in Base64 and inserting them into HTML;
- Converting HTML to PDF on the fly;
- The `/dist/` folder contains *only* complete HTML and PDF files.

‚ùóÔ∏è Sourcemaps are not available in **production** mode.

> The `temp/` folder is automatically created to store intermediate assembly files and speed up processes in production
> mode.

#### Development

Building/running a project in **development** mode means:
- Sourcemaps are available;
- All CSS classes of the project are available in devtools;
- Images and code are not compressed or optimized;
- All project resources are placed in the `/dist/` folder.

### Build and run

| Command                 | Description                                                                            |
|:------------------------|:---------------------------------------------------------------------------------------|
| `npm start`             | Running the project in production mode with PDF generation on the fly                  |
| `npm run prod`          | Running the project in production mode                                                 |
| `npm run prod:mock`     | Running the project in production mode with data mocking on the fly                    |
| `npm run prod:mock-pdf` | Running the project in production mode with data mocking and on-the-fly PDF generation |
| `npm run dev`           | Running the project in development mode                                                |
| `npm run dev:pdf`       | Running the project in development mode with on-the-fly PDF generation                 |
| `npm run build`         | Building the project in production mode                                                |
| `npm run build:mock`    | Building the project in production mode with data mocking                              |
| `npm run build-dev`     | Building the project in development mode                                               |
| `npm run clean`         | Deleting the `/dist/` and `/temp/` folders                                             |

> The `npm start` command starts the project with HTML-to-PDF conversion on the fly. When working with a PDF, seeing the
> immediate result (that is as close to the final one as possible) is important: open the PDF file in another IDE tab to
> immediately see the changes.

### HTML-to-PDF conversion and data mocking

> Learn about data mocking in ASAP PDF [here](?path=/story/test-mocking--page).

To convert HTML to PDF, the project must be already running (for example, in a separate terminal tab). The reason is
that PDFs are generated by Puppeeteer, which navigates to the page at the development server address, not the file path.

| Command            | Description                                                                                                                                   |
|:-------------------|:----------------------------------------------------------------------------------------------------------------------------------------------|
| `npm run pdf`      | Generate PDF from HTML (the project must be **running** in any mode)                                                                          |
| `npm run mock`     | Mocking HTML files (the project must be **built** in [production mode](?path=/story/get-started-npm-scripts--page#production))                |
| `npm run mock-pdf` | Mocking HTML files and generating PDF (the project must be **running** in [production mode](?path=/story/get-started-project-settings--page)) |

> Data mocking does not work with files built in
> [development mode](?path=/story/get-started-npm-scripts--page#development) because the mocked files are moved to the
> `/mocked/` subfolder so resource paths in HTML files become irrelevant.

> You can duplicate the `html2pdfConfig.default.js` file, rename it to `html2pdfConfig.js`, and store your own
> HTML-to-PDF conversion settings there. Changes to the file with custom settings will not be tracked by Git (the file
> added to gitignore).

> Choose HTML files to be converted to PDF on the fly to speed up the process. For this, you need to set the
> `convertAll` parameter to `false` in the `gulp/config/html2pdfConfig.js` file (learn how to create this file above)
> and specify the list of pages to be converted in the `pageList` array.

### Screenshot testing

To create screenshots, the project must be already running (for example, in a separate terminal tab). The reason is that
screenshots are generated by Puppeeteer, which navigates to the page at the development server address, not the file
path.

| Command              | Description                                                                                                                           |
|:---------------------|:--------------------------------------------------------------------------------------------------------------------------------------|
| `npm run sc:init`    | Creating golden screenshots (the project must be **running** in any mode)                                                             |
| `npm run sc:compare` | Creating and comparing screenshots of the project in the current state with golden ones (the project must be **running** in any mode) |
| `npm run sc:refresh` | Replacing old golden screenshots with new ones                                                                                        |

> Screenshot testing settings are stored in the `gulp/config/test/sc.js` file.

### Pdf2img testing

> In ASAP PDF, pdf2img testing involves the conversion of PDF files to images (with page breaks displayed) and the
> comparison of the resulting images with golden ones. Learn more [here](?path=/story/test-about--page#pdf2img).

[Poppler](?path=/story/get-started-install-poppler--page) must be installed for the pdf2img scripts.

PDF files must be generated before testing because the scripts in this section only create images from PDF and compare
them. To generate a PDF, run `npm start` or build the project in production mode and run `npm run pdf` in a separate
terminal.

| Command                   | Description                                                                                 |
|:--------------------------|:--------------------------------------------------------------------------------------------|
| `npm run pdf2img:init`    | Creating golden images from PDF                                                             |
| `npm run pdf2img:compare` | Creating and comparing images from PDF of the project in the current state with golden ones |
| `npm run pdf2img:refresh` | Replacing old PDF golden images with new ones                                               |

> The pdf2img test settings are stored in the `gulp/config/test/pdf.js` file.

### Full project testing

Running a full project test is possible only when the following requirements are met:

1. The project is running with `npm run prod:mock-pdf` or `npm start`;
> The reason is that PDFs and screenshots are generated by Puppeeteer, which navigates to the page at the development
> server address, not the file path.
2. Golden screenshots are created (`sc:init`);
3. Golden images are generated from PDF (`pdf2img:init`).

| Command                | Description                                                                                                                                                                                         |
|------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `npm test`             | - Creating screenshots from HTML<br />- Creating images from PDF<br />- Comparing new images with golden ones<br /><br />‚ùóÔ∏è The project must be running with `npm run prod:mock-pdf` or `npm start` |
| `npm run test:refresh` | - Replacing old golden screenshots with new ones<br />- Replacing old PDF golden images with new ones<br />- Cleaning up folders with actual screenshots and PDF images                             |

> Learn more about testing in ASAP PDF [here](?path=/story/test-about--page).

### SCSS lint

| Command             | Description                           |
|:--------------------|:--------------------------------------|
| `npm run scss:lint` | Linting SCSS files                    |
| `npm run scss:fix`  | Linting and autocorrecting SCSS files |

### Storybook

| Command                   | Description        |
|:--------------------------|:-------------------|
| `npm run storybook`       | Running Storybook  |
| `npm run build-storybook` | Building Storybook |
